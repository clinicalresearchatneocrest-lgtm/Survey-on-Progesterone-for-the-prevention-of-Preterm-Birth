<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Preterm Birth – SurveyJS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SurveyJS (vanilla) -->
  <link href="https://unpkg.com/survey-core/survey-core.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/survey-core/survey.core.min.js"></script>
  <script src="https://unpkg.com/survey-js-ui/survey-js-ui.min.js"></script>

  <!-- Free look-alike for Century Gothic -->
  <link href="https://fonts.googleapis.com/css2?family=Questrial&display=swap" rel="stylesheet">

  <!-- Basic layout -->
  <style>
    body { margin: 24px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    #surveyContainer { max-width: 960px; margin: 0 auto; }
    #errbox { background:#fff3cd; color:#664d03; border:1px solid #ffecb5; padding:12px; border-radius:8px; margin:12px 0; display:none; white-space:pre-wrap; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
  </style>

  <!-- Font overrides: title 14px, description 12px -->
  <style>
    .sd-root-modern, .sv-root {
      --sjs-font-family: "Questrial", Arial, sans-serif;
      font-family: var(--sjs-font-family) !important;
    }
    /* Survey header title (top) */
    #surveyContainer .sd-header h3.sd-title,
    #surveyContainer .sv-header__title,
    #surveyContainer h3.sv-title {
      font-family: "Questrial", Arial, sans-serif !important;
      font-size: 14px !important;
      font-weight: 400 !important;
      line-height: 1.35 !important;
      letter-spacing: 0.2px;
      margin: 0 0 6px 0 !important;
    }
    /* Survey header description */
    #surveyContainer .sd-header .sd-description,
    #surveyContainer .sv-description {
      font-family: "Questrial", Arial, sans-serif !important;
      font-size: 12px !important;
      font-weight: 400 !important;
      line-height: 1.5 !important;
      color: #333 !important;
    }
    /* Page titles (“Consent”, etc.) */
    #surveyContainer h3.sd-title.sd-page__title,
    #surveyContainer .sd-page__title,
    #surveyContainer h3.sv-page__title,
    #surveyContainer .sv_page_title {
      font-family: "Questrial", Arial, sans-serif !important;
      font-size: 14px !important;
      font-weight: 400 !important;
      line-height: 1.35 !important;
    }
  </style>
</head>

<body>
  <noscript>Enable JavaScript to view this survey.</noscript>
  <div id="errbox"></div>
  <div id="surveyContainer"></div>

  <script>
  // === show runtime errors on page ===
  const showErr = (msg) => {
    const box = document.getElementById("errbox");
    box.style.display = "block";
    box.textContent = msg;
  };
  window.addEventListener("error", e => {
    showErr("Error: " + e.message + "\n" + (e.error && e.error.stack ? e.error.stack : ""));
  });
  window.addEventListener("unhandledrejection", e => {
    showErr("Promise error: " + (e.reason && (e.reason.stack || e.reason.message) || e.reason));
  });

  // === Survey JSON (unchanged) ===
  const surveyJson = /* your JSON object exactly as in your file */ <?/* keep your existing JSON here */?>;

  // Create model + submit + render
  document.addEventListener("DOMContentLoaded", () => {
    if (!window.Survey || !Survey.Model) {
      showErr("SurveyJS library did not load. Check that these return 200 in Network tab:\n- survey-core.min.js\n- survey-js-ui.min.js");
      return;
    }

    const survey = new Survey.Model(surveyJson);

    // --- send to Google Sheets (unchanged) ---
    const SHEETS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbywmEzWa9bbjFCt1xEzPUQvfxzjoGG8VtEygYikkEmla6_hm8Qs6JF1_T6VfziCJG1MQg/exec";
    survey.onComplete.add(async ({ data }) => {
      try {
        const meta = Object.fromEntries(new URLSearchParams(location.search).entries());
        const payload = { ...data, _meta: { ...meta, submittedAt: new Date().toISOString() } };
        await fetch(SHEETS_WEB_APP_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(payload)
        });
        alert("Thanks! Your response has been recorded.");
      } catch (err) {
        console.error(err);
        alert("Submitted, but we couldn't confirm the save.");
      }
    });

    const target = document.getElementById("surveyContainer");
    survey.render(target);

    // --- FORCE HEADER FONTS (bulletproof) ---
    const forceHeaderFonts = () => {
      // TITLE → 14px
      const titleSel = [
        '#surveyContainer .sd-header__text .sd-title',
        '#surveyContainer .sd-header .sd-title',
        '#surveyContainer .sv-header__title',
        '#surveyContainer h3.sv-title'
      ].join(', ');
      document.querySelectorAll(titleSel).forEach(el => {
        el.style.setProperty('font-family', '"Questrial", Arial, sans-serif', 'important');
        el.style.setProperty('font-size', '14px', 'important');
        el.style.setProperty('font-weight', '400', 'important');
        el.style.setProperty('line-height', '1.35', 'important');
      });

      // DESCRIPTION → 12px
      const descSel = [
        '#surveyContainer .sd-header__text .sd-description',
        '#surveyContainer .sd-header .sd-description',
        '#surveyContainer .sv-description'
      ].join(', ');
      document.querySelectorAll(descSel).forEach(el => {
        el.style.setProperty('font-family', '"Questrial", Arial, sans-serif', 'important');
        el.style.setProperty('font-size', '12px', 'important');
        el.style.setProperty('font-weight', '400', 'important');
        el.style.setProperty('line-height', '1.5', 'important');
        el.style.setProperty('color', '#333', 'important');
      });

      // PAGE TITLES (optional, 14px to match)
      const pageTitleSel = [
        '#surveyContainer h3.sd-title.sd-page__title',
        '#surveyContainer .sd-page__title',
        '#surveyContainer h3.sv-page__title',
        '#surveyContainer .sv_page_title'
      ].join(', ');
      document.querySelectorAll(pageTitleSel).forEach(el => {
        el.style.setProperty('font-family', '"Questrial", Arial, sans-serif', 'important');
        el.style.setProperty('font-size', '14px', 'important');
        el.style.setProperty('font-weight', '400', 'important');
        el.style.setProperty('line-height', '1.35', 'important');
      });
    };

    // apply now
    forceHeaderFonts();

    // re-apply on any SurveyJS re-render
    survey.onAfterRenderSurvey.add(forceHeaderFonts);
    survey.onAfterRenderPage.add(forceHeaderFonts);
    survey.onCurrentPageChanged.add(forceHeaderFonts);

    // re-apply if the header DOM mutates (some themes replace nodes)
    const header = document.querySelector('#surveyContainer .sd-header') || document.querySelector('#surveyContainer .sv-header');
    if (header) {
      const mo = new MutationObserver(() => forceHeaderFonts());
      mo.observe(header, { childList: true, subtree: true });
    }
  });
</script>
</body>
</html>

